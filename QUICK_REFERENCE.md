# ä»£ç ä¼˜åŒ–å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸ“‹ ç›®å½•

- [ä¼˜åŒ–æ¦‚è§ˆ](#ä¼˜åŒ–æ¦‚è§ˆ)
- [ä¸»è¦æ”¹è¿›ç‚¹](#ä¸»è¦æ”¹è¿›ç‚¹)
- [å¿«é€Ÿå¯¹æ¯”](#å¿«é€Ÿå¯¹æ¯”)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ¯ ä¼˜åŒ–æ¦‚è§ˆ

æœ¬æ¬¡ä¼˜åŒ–æ¶µç›–äº†ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š

1. **ä¸»ç¨‹åº** (`main.rs`) - ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå‘½ä»¤è·¯ç”±
2. **å·¥å…·å‡½æ•°** (`utils.rs`) - å¢å¼ºåŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŒ–
3. **é…ç½®åŠ è½½** (`constants.rs`) - æ”¹è¿›é”™è¯¯å¤„ç†
4. **Pingæ¨¡å—** (`ping.rs`) - æ·»åŠ å“åº”æ—¶é—´å’Œç»Ÿè®¡
5. **ç«¯å£æ‰«æ** (`portscan.rs`) - ä»£ç é‡æ„å’ŒåŠŸèƒ½å¢å¼º

---

## ğŸš€ ä¸»è¦æ”¹è¿›ç‚¹

### 1. é”™è¯¯å¤„ç†

**ä¼˜åŒ–å‰:**
```rust
handle_error(net::ping::run(&args).await, "Ping æ‰«æå¤±è´¥");
```

**ä¼˜åŒ–å:**
```rust
net::ping::run(&args).await?;
// é”™è¯¯ä¼šè‡ªåŠ¨ä¼ æ’­åˆ° main å‡½æ•°ç»Ÿä¸€å¤„ç†
```

### 2. è¿›åº¦æ¡æ˜¾ç¤º

**ä¼˜åŒ–å‰:**
```rust
pb.inc(1);
```

**ä¼˜åŒ–å:**
```rust
progress.inc(1);
progress.println("âœ… å‘ç°: 192.168.1.1:80");
progress.finish_with_message("âœ… æ‰«æå®Œæˆ");
```

### 3. IP è§£æ

**ä¼˜åŒ–å‰:**
```rust
let ips = parse_targets(&args.targets)?;
// å¯èƒ½è§£æå¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¸æ˜ç¡®
```

**ä¼˜åŒ–å:**
```rust
let ips = parse_targets(&args.targets)?;
// æ”¯æŒæ›´å¤šæ ¼å¼ï¼Œé”™è¯¯ä¿¡æ¯æ›´è¯¦ç»†
// æ”¯æŒ: å•IPã€å¤šIPã€CIDRã€èŒƒå›´
// è‡ªåŠ¨éªŒè¯å’Œå»é‡
```

### 4. é…ç½®åŠ è½½

**ä¼˜åŒ–å‰:**
```rust
let cmds = load_commands_from_yaml(path, cmd_type);
// è¿”å› Vec<String>ï¼Œå¤±è´¥æ—¶è¿”å›ç©ºæ•°ç»„
```

**ä¼˜åŒ–å:**
```rust
let cmds = load_commands_from_yaml(path, cmd_type)?;
// è¿”å› Resultï¼Œå¤±è´¥æ—¶åŒ…å«è¯¦ç»†é”™è¯¯ä¿¡æ¯
```

### 5. ç»Ÿè®¡æŠ¥å‘Š

**ä¼˜åŒ–å‰:**
```rust
println!("âœ… æ‰«æå®Œæˆï¼Œå…±è¯†åˆ«å­˜æ´»ä¸»æœº{}ä¸ª", count);
```

**ä¼˜åŒ–å:**
```rust
println!("\nğŸ“Š æ‰«æç»Ÿè®¡:");
println!("   æ€»è®¡: {} ä¸ªIP", total);
println!("   å­˜æ´»: {} ä¸ª ({:.1}%)", alive, percent);
println!("   å¤±è´¥: {} ä¸ª ({:.1}%)", failed, percent);
println!("   è€—æ—¶: {:.2?}", elapsed);
```

---

## ğŸ“Š å¿«é€Ÿå¯¹æ¯”

| ç‰¹æ€§ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| **é”™è¯¯å¤„ç†** | å¤šç§æ–¹å¼æ··ç”¨ | ç»Ÿä¸€ä½¿ç”¨ Result |
| **è¿›åº¦æ˜¾ç¤º** | åŸºç¡€è¿›åº¦æ¡ | è¯¦ç»†è¿›åº¦æ¡+æ¶ˆæ¯ |
| **ç»Ÿè®¡ä¿¡æ¯** | ç®€å•è®¡æ•° | è¯¦ç»†ç»Ÿè®¡+ç™¾åˆ†æ¯” |
| **æ–‡æ¡£æ³¨é‡Š** | éƒ¨åˆ†ç¼ºå¤± | å®Œæ•´çš„æ–‡æ¡£ |
| **å•å…ƒæµ‹è¯•** | æ—  | 15+ æµ‹è¯•ç”¨ä¾‹ |
| **ä»£ç è¡Œæ•°/å‡½æ•°** | 50+ è¡Œ | 30 è¡Œå·¦å³ |

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### Ping æ‰«æ

**åŸºç¡€ç”¨æ³•:**
```bash
# æ‰«æå•ä¸ªIP
gxtools net ping -t 192.168.1.1

# æ‰«æç½‘æ®µ
gxtools net ping -t 192.168.1.0/24

# æ‰«æèŒƒå›´
gxtools net ping -t 192.168.1.1-50
```

**é«˜çº§ç”¨æ³•:**
```bash
# æ˜¾ç¤ºè¯¦ç»†ç»“æœ
gxtools net ping -t 192.168.1.0/24 -e

# å¯¼å‡ºåˆ°Excel
gxtools net ping -t 192.168.1.0/24 -o

# è‡ªå®šä¹‰è¶…æ—¶å’Œå¹¶å‘
gxtools net ping -t 192.168.1.0/24 -T 5 -c 200 -n 5
```

**è¾“å‡ºç¤ºä¾‹:**
```
ğŸ” å¼€å§‹Pingæ‰«æï¼Œå…± 254 ä¸ªç›®æ ‡IP
âš™ï¸  é…ç½®: è¶…æ—¶=2ç§’, é‡è¯•=3æ¬¡, å¹¶å‘=100
[00:00:15] [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 254/254 (100%) [ETA: 0s]
âœ… Pingæ‰«æå®Œæˆ

ğŸ“Š æ‰«æç»Ÿè®¡:
   æ€»è®¡: 254 ä¸ªIP
   å­˜æ´»: 45 ä¸ª (17.7%)
   å¤±è´¥: 209 ä¸ª (82.3%)
   è€—æ—¶: 15.32s
```

### ç«¯å£æ‰«æ

**åŸºç¡€ç”¨æ³•:**
```bash
# æ‰«æå¸¸ç”¨ç«¯å£
gxtools pentest scan -t 192.168.1.1

# æ‰«ææŒ‡å®šç«¯å£
gxtools pentest scan -t 192.168.1.1 -p 22,80,443,3306

# æ‰«æç«¯å£èŒƒå›´
gxtools pentest scan -t 192.168.1.1 -p 1-1000
```

**é«˜çº§ç”¨æ³•:**
```bash
# å…ˆæ£€æµ‹å­˜æ´»ä¸»æœº
gxtools pentest scan -t 192.168.1.0/24 --live

# å…¨ç«¯å£æ‰«æ
gxtools pentest scan -t 192.168.1.1 --full

# å¯¼å‡ºç»“æœ
gxtools pentest scan -t 192.168.1.0/24 -o

# è‡ªå®šä¹‰å¹¶å‘
gxtools pentest scan -t 192.168.1.0/24 -c 500
```

**è¾“å‡ºç¤ºä¾‹:**
```
ğŸ” å¼€å§‹ä¸»æœºå­˜æ´»æ¢æµ‹...
âœ… å‘ç° 5 ä¸ªå­˜æ´»ä¸»æœº
ğŸ” å¼€å§‹ç«¯å£æ‰«æ: 5 ä¸ªIP Ã— 100 ä¸ªç«¯å£ = 500 ä¸ªä»»åŠ¡
âš™ï¸  é…ç½®: å¹¶å‘=200
[00:00:08] [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 500/500 (100%) [ETA: 0s]
  âœ… 192.168.1.1:22 | OpenSSH 8.2 | ["ssh-banner"]
  âœ… 192.168.1.1:80 | nginx/1.18.0 | ["http-response"]
  âœ… 192.168.1.2:3306 | MySQL 5.7.35 | ["mysql-handshake"]
âœ… ç«¯å£æ‰«æå®Œæˆ

ğŸ“Š æ‰«æç»Ÿè®¡:
   æ€»è®¡: 500 ä¸ªç«¯å£
   å¼€æ”¾: 12 ä¸ª (2.4%)
   å…³é—­: 488 ä¸ª (97.6%)
   è€—æ—¶: 8.45s

ğŸ”“ å¼€æ”¾ç«¯å£è¯¦æƒ…:
   192.168.1.1 => [22, 80, 443]
   192.168.1.2 => [3306, 6379]
   192.168.1.3 => [22, 5432]
```

---

## ğŸ”§ æ–°å¢åŠŸèƒ½

### 1. å“åº”æ—¶é—´æ˜¾ç¤º (Ping)

ç°åœ¨ Ping æ‰«æä¼šæ˜¾ç¤ºæ¯ä¸ªä¸»æœºçš„å“åº”æ—¶é—´ï¼š

```bash
gxtools net ping -t 192.168.1.1-10 -e
```

è¾“å‡ºï¼š
```
  âœ… 192.168.1.1 => å­˜æ´» (1.23ms)
  âœ… 192.168.1.2 => å­˜æ´» (2.45ms)
  âœ… 192.168.1.5 => å­˜æ´» (0.98ms)
```

### 2. å­˜æ´»æ¢æµ‹ (ç«¯å£æ‰«æ)

å…ˆè¿›è¡Œ Ping æ‰«æï¼Œåªå¯¹å­˜æ´»ä¸»æœºè¿›è¡Œç«¯å£æ‰«æï¼š

```bash
gxtools pentest scan -t 192.168.1.0/24 --live
```

ä¼˜åŠ¿ï¼š
- å‡å°‘æ— æ•ˆæ‰«æ
- æé«˜æ‰«ææ•ˆç‡
- èŠ‚çœæ—¶é—´å’Œèµ„æº

### 3. è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š

æ‰€æœ‰æ¨¡å—ç°åœ¨éƒ½æä¾›è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯ï¼š
- æ€»æ•°ã€æˆåŠŸæ•°ã€å¤±è´¥æ•°
- ç™¾åˆ†æ¯”ç»Ÿè®¡
- è€—æ—¶ç»Ÿè®¡
- åˆ†ç»„æ˜¾ç¤ºï¼ˆç«¯å£æ‰«æï¼‰

### 4. å®ç”¨å·¥å…·å‡½æ•°

```rust
// æ ¼å¼åŒ–å­—èŠ‚å¤§å°
format_bytes(1048576) // "1.00 MB"

// æ ¼å¼åŒ–æ—¶é—´
format_duration(3661) // "1h 1m 1s"
```

---

## âš™ï¸ é…ç½®å‚æ•°

### é»˜è®¤å€¼

```rust
DEFAULT_TIMEOUT_SECS = 10      // é»˜è®¤è¶…æ—¶æ—¶é—´
DEFAULT_CONCURRENCY = 100      // é»˜è®¤å¹¶å‘æ•°
DEFAULT_RETRY_COUNT = 3        // é»˜è®¤é‡è¯•æ¬¡æ•°
DEFAULT_OUTPUT_DIR = "output"  // é»˜è®¤è¾“å‡ºç›®å½•
```

### ä¿®æ”¹é»˜è®¤å€¼

åœ¨ä»£ç ä¸­ä¿®æ”¹ `src/constants.rs`:

```rust
pub const DEFAULT_CONCURRENCY: usize = 200; // ä¿®æ”¹ä¸º 200
```

æˆ–åœ¨å‘½ä»¤è¡ŒæŒ‡å®šï¼š

```bash
gxtools net ping -t 192.168.1.0/24 -c 200
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæœ‰äº›æµ‹è¯•éœ€è¦ `tempfile` ä¾èµ–ï¼Ÿ

**A:** å•å…ƒæµ‹è¯•ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ¥æµ‹è¯•æ–‡ä»¶æ“ä½œï¼Œéœ€è¦æ·»åŠ åˆ° `Cargo.toml`:

```toml
[dev-dependencies]
tempfile = "3"
```

### Q2: å¦‚ä½•è¿è¡Œå•å…ƒæµ‹è¯•ï¼Ÿ

**A:** ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæ¨¡å—
cargo test utils::tests

# æ˜¾ç¤ºè¾“å‡º
cargo test -- --nocapture

# è¿è¡Œå•ä¸ªæµ‹è¯•
cargo test test_parse_single_ip
```

### Q3: ç¼–è¯‘æ—¶å‡ºç°è­¦å‘Šæ€ä¹ˆåŠï¼Ÿ

**A:** è¿è¡Œä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–ï¼š

```bash
# æ£€æŸ¥ä»£ç 
cargo clippy --all-targets

# æ ¼å¼åŒ–ä»£ç 
cargo fmt

# ä¿®å¤ç®€å•é—®é¢˜
cargo fix --allow-dirty
```

### Q4: å¦‚ä½•æé«˜æ‰«æé€Ÿåº¦ï¼Ÿ

**A:** è°ƒæ•´å¹¶å‘æ•°ï¼š

```bash
# Ping æ‰«æï¼ˆæ¨è 100-200ï¼‰
gxtools net ping -t 192.168.1.0/24 -c 200

# ç«¯å£æ‰«æï¼ˆæ¨è 200-500ï¼‰
gxtools pentest scan -t 192.168.1.0/24 -c 500
```

æ³¨æ„ï¼šå¹¶å‘æ•°è¿‡é«˜å¯èƒ½å¯¼è‡´ï¼š
- ç³»ç»Ÿèµ„æºè€—å°½
- ç½‘ç»œæ‹¥å¡
- é˜²ç«å¢™æ‹¦æˆª

### Q5: Excel æ–‡ä»¶ä¿å­˜åœ¨å“ªé‡Œï¼Ÿ

**A:** é»˜è®¤ä¿å­˜åœ¨ `output/<æ¨¡å—å>/` ç›®å½•ï¼š

- Ping: `output/ping/ping_20240101_120000.xlsx`
- ç«¯å£æ‰«æ: `output/portscan/portscan_20240101_120000.xlsx`

---

## ğŸ“ ä»£ç é£æ ¼æŒ‡å—

### 1. å‡½æ•°å‘½å

```rust
// åŠ¨è¯+åè¯
parse_targets()
load_config()
scan_single_port()

// æ£€æŸ¥å‡½æ•°ç”¨ is_ å‰ç¼€
is_open()
is_success()
```

### 2. é”™è¯¯å¤„ç†

```rust
// ä½¿ç”¨ ? æ“ä½œç¬¦
let ips = parse_targets(&args.targets)?;

// æä¾›ä¸Šä¸‹æ–‡
.map_err(|e| format!("è§£æIPå¤±è´¥: {}", e))?

// é¿å… unwrap
let value = option.ok_or("æœªæ‰¾åˆ°å€¼")?;
```

### 3. æ–‡æ¡£æ³¨é‡Š

```rust
/// è§£æç›®æ ‡IPåœ°å€å­—ç¬¦ä¸²
///
/// # å‚æ•°
/// * `targets` - ç›®æ ‡å­—ç¬¦ä¸²
///
/// # è¿”å›
/// * `Ok(Vec<String>)` - IPåœ°å€åˆ—è¡¨
/// * `Err` - è§£æå¤±è´¥
///
/// # ç¤ºä¾‹
/// ```
/// let ips = parse_targets("192.168.1.0/24")?;
/// ```
pub fn parse_targets(targets: &str) -> Result<Vec<String>, Box<dyn Error>> {
    // ...
}
```

### 4. è¿›åº¦æ˜¾ç¤º

```rust
let progress = ScanProgress::new(total as u64);

for item in items {
    // å¤„ç†...
    
    // è¾“å‡ºä¿¡æ¯ï¼ˆä¸ç ´åè¿›åº¦æ¡ï¼‰
    progress.println(format!("âœ… å®Œæˆ: {}", item));
    
    // æ›´æ–°è¿›åº¦
    progress.inc(1);
}

progress.finish_with_message("âœ… å…¨éƒ¨å®Œæˆ");
```

---

## ğŸ“ å­¦ä¹ èµ„æº

### ä¼˜åŒ–æŠ€å·§

1. **é¢„åˆ†é…å®¹é‡**
   ```rust
   let mut vec = Vec::with_capacity(expected_size);
   ```

2. **ä½¿ç”¨ Arc å…±äº«æ•°æ®**
   ```rust
   let data = Arc::new(Mutex::new(Vec::new()));
   let clone = data.clone();
   ```

3. **ä¿¡å·é‡æ§åˆ¶å¹¶å‘**
   ```rust
   let sem = Arc::new(Semaphore::new(max_concurrent));
   let permit = sem.acquire_owned().await?;
   ```

4. **é¿å…ä¸å¿…è¦çš„å…‹éš†**
   ```rust
   // ä¸å¥½
   fn process(data: String) { }
   
   // å¥½
   fn process(data: &str) { }
   ```

### Rust èµ„æº

- [Rust å®˜æ–¹æ–‡æ¡£](https://doc.rust-lang.org/)
- [Rust å¼‚æ­¥ç¼–ç¨‹](https://rust-lang.github.io/async-book/)
- [Tokio æ•™ç¨‹](https://tokio.rs/tokio/tutorial)
- [Clippy Lints](https://rust-lang.github.io/rust-clippy/)

---

## ğŸ“Œ æç¤ºå’ŒæŠ€å·§

### å¼€å‘æŠ€å·§

1. **ä½¿ç”¨ `cargo watch` è‡ªåŠ¨ç¼–è¯‘**
   ```bash
   cargo install cargo-watch
   cargo watch -x check -x test
   ```

2. **è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºæ›´å¤šä¿¡æ¯**
   ```bash
   RUST_LOG=debug cargo run
   ```

3. **ç”Ÿæˆæ–‡æ¡£**
   ```bash
   cargo doc --open
   ```

4. **æ£€æŸ¥ä¾èµ–æ›´æ–°**
   ```bash
   cargo outdated
   ```

### æ€§èƒ½åˆ†æ

```bash
# ä½¿ç”¨ flamegraph åˆ†ææ€§èƒ½
cargo install flamegraph
cargo flamegraph

# ä½¿ç”¨ criterion è¿›è¡ŒåŸºå‡†æµ‹è¯•
cargo bench
```

---

## ğŸ”„ ç‰ˆæœ¬å†å²

### v0.2.0 (ä¼˜åŒ–ç‰ˆæœ¬)
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… å¢å¼ºè¿›åº¦æ˜¾ç¤º
- âœ… æ·»åŠ å“åº”æ—¶é—´ç»Ÿè®¡
- âœ… æ”¹è¿›ä»£ç ç»“æ„
- âœ… æ·»åŠ å•å…ƒæµ‹è¯•
- âœ… å®Œå–„æ–‡æ¡£æ³¨é‡Š

### v0.1.0 (åˆå§‹ç‰ˆæœ¬)
- åŸºç¡€ Ping æ‰«æ
- åŸºç¡€ç«¯å£æ‰«æ
- Excel å¯¼å‡ºåŠŸèƒ½

---

## ğŸ“ è·å–å¸®åŠ©

### å‘½ä»¤è¡Œå¸®åŠ©

```bash
# æŸ¥çœ‹ä¸»å¸®åŠ©
gxtools --help

# æŸ¥çœ‹å­å‘½ä»¤å¸®åŠ©
gxtools net --help
gxtools net ping --help
gxtools pentest scan --help
```

### åé¦ˆå’Œè´¡çŒ®

- æäº¤ Issue: æŠ¥å‘Š bug æˆ–å»ºè®®åŠŸèƒ½
- Pull Request: è´¡çŒ®ä»£ç 
- æ–‡æ¡£æ”¹è¿›: å¸®åŠ©å®Œå–„æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2024å¹´
**ç»´æŠ¤è€…**: GX Tools Team